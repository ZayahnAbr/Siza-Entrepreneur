<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Entrepreneur Dashboard - Siza Innovator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <div class="container header-row">
    <a class="brand" href="index.html">Siza Innovator</a>

    <nav class="site-nav">
      <ul class="left">
        <li><a href="index.html">Home</a></li>
        <li><a href="messages.html">Messages</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="forum.html">Forum</a></li>
        <li><a href="deal-room.html">Deal Room</a></li>
      </ul>

      <ul class="right">
        <!-- shown when NOT logged in -->
        <li id="nav-login"><a href="#auth">Log in</a></li>

        <!-- shown when logged in (script.js fills hrefs and shows them) -->
        <li><a id="nav-dashboard" style="display:none;">My Dashboard</a></li>
        <li><a id="nav-profile"  style="display:none;">My Profile</a></li>
        <li><a id="nav-edit"     style="display:none;">Edit Profile</a></li>
        <li><a id="nav-logout"   href="#" style="display:none;">Log out</a></li>
        <li>
          <img id="navAvatar" class="nav-avatar" alt="User avatar"
               style="display:none;width:32px;height:32px;border-radius:50%;object-fit:cover;margin-left:.5rem;">
        </li>
      </ul>
    </nav>
  </div>
</header>


<main>
  <section class="dashboard-section">
    <div class="container">
      <img id="profilePic" src="" alt="Profile Picture" class="profile-img">
      <h2>Welcome back, <span id="username">User</span> ðŸ‘‹</h2>

      <!-- ===== PITCH SUBMISSION FORM ===== -->
      <div class="idea-card">
        <h3>Submit a New Pitch</h3>
        <form id="pitchForm">
          <input type="text" id="pitchTitle" placeholder="Business Name" required /><br />
          <textarea id="shortPitch" placeholder="Short Pitch (shown to investors)" required maxlength="200"></textarea><br />
          <textarea id="pitchDescription" placeholder="Long Pitch / Description (NDA required)" required></textarea><br />
          <textarea id="financialProjections" placeholder="Financial Projections (NDA required)" required></textarea><br />

          <label for="pitchImage">Upload an image (optional):</label><br />
          <input type="file" id="pitchImage" accept="image/*" /><br />
          <img id="pitchImagePreview" src="" alt="Image preview" style="max-width: 300px; margin-top: 10px; display: none;" /><br />

          <label for="pitchVideo">Upload a video (optional):</label><br />
          <input type="file" id="pitchVideo" accept="video/*" /><br />
          <video id="pitchVideoPreview" controls style="max-width: 300px; margin-top: 10px; display: none;"></video><br />

          <button type="submit" class="btn">Submit Pitch</button>
        </form>
      </div>

      <!-- ===== COMMUNITY FEED ===== -->
      <h2>Community Feed</h2>
      <form class="post-form" id="postForm">
        <textarea id="new-post" rows="4" placeholder="What's on your mind?" required></textarea>
        <div class="post-form-bottom">
          <input type="file" id="post-image" accept="image/*" />
          <label for="post-image" class="image-upload-label">ðŸ“· Add Image</label>
          <div class="post-preview-img">
            <img id="image-preview" src="" alt="" style="display:none;" />
          </div>
          <button type="submit" class="btn">Post</button>
        </div>
      </form>

      <div id="post-feed" class="forum-thread"></div>
    </div>
  </section>
</main>

<footer>
  <div class="container">
    <p>&copy; 2025 Siza Innovator. All rights reserved.</p>
  </div>
</footer>

<!-- ===== FIREBASE + AUTH LOGIC ===== -->
<script type="module">
import { db, storage, getStoredUser, submitPitch, logout } from './auth.js';
import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js";

document.addEventListener("DOMContentLoaded", () => {
  const user = getStoredUser();
  if (!user) return window.location.href = "login.html";

  // dynamic nav
  const navUl = document.querySelector("header nav ul");
  navUl.innerHTML = `
    <li><a href="${user.accountType === 'investor' ? 'investor-dashboard.html' : 'entrepreneur-dashboard.html'}">Home</a></li>
    <li><a href="messages.html">Messages</a></li>
    <li><a href="resources.html">Resources</a></li>
    <li><a href="events.html">Events</a></li>
    <li><a href="forum.html">Forum</a></li>
    <li><a href="deal-room.html">Deal Room</a></li>
    <li><a href="edit-${user.accountType}.html">Profile</a></li>
    <li><a href="#" id="logoutBtn">Logout</a></li>
  `;

  document.getElementById("logoutBtn").addEventListener("click", logout);

  // fill user info
  document.getElementById("username").textContent = user.name || "User";
  if(user.profilePic) document.getElementById("profilePic").src = user.profilePic;

  // pitch submission
  const pitchForm = document.getElementById("pitchForm");
  const imageInput = document.getElementById("pitchImage");
  const imagePreview = document.getElementById("pitchImagePreview");
  const videoInput = document.getElementById("pitchVideo");
  const videoPreview = document.getElementById("pitchVideoPreview");

  imageInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = ()=> { imagePreview.src = reader.result; imagePreview.style.display="block"; }
      reader.readAsDataURL(file);
    } else { imagePreview.style.display="none"; }
  });

  videoInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if(file){ videoPreview.src = URL.createObjectURL(file); videoPreview.style.display="block"; }
    else videoPreview.style.display="none";
  });

  pitchForm.addEventListener("submit", async e => {
    e.preventDefault();
    const title = document.getElementById("pitchTitle").value.trim();
    const shortPitch = document.getElementById("shortPitch").value.trim();
    const description = document.getElementById("pitchDescription").value.trim();
    const financialProjections = document.getElementById("financialProjections").value.trim();
    if(!title || !shortPitch || !description || !financialProjections){ return alert("Fill all fields."); }

    try{
      const files = {};
      if(imageInput.files[0]) files.image = imageInput.files[0];
      if(videoInput.files[0]) files.video = videoInput.files[0];
      const pitchData = { title, shortPitch, description, financialProjections };
      await submitPitch(pitchData, files);
      alert("Pitch submitted successfully!");
      pitchForm.reset();
      imagePreview.style.display="none";
      videoPreview.style.display="none";
    }catch(err){ console.error(err); alert("Error submitting pitch."); }
  });
});
</script>
<script type="module" src="script.js"></script>
</body>
</html>


